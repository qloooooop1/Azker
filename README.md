# Azker

## بوت أذكار تلجرام مع لوحة تحكم كاملة

### المميزات
- ✅ نشر الأذكار التلقائي للمجموعات
- ✅ **تسجيل المجموعات تلقائياً** - عند إضافة البوت كمشرف
- ✅ **رسائل ترحيب** - رسالة ترحيب تلقائية عند الإضافة للمجموعات
- ✅ **أوامر تفاعلية** - الرد على /start وجميع الأوامر
- ✅ لوحة تحكم كاملة للمطور
- ✅ دعم الملفات الصوتية و PDF
- ✅ جدولة متقدمة للأذكار
- ✅ **تخزين دائم للبيانات** - لا تفقد الأذكار عند إعادة التشغيل
- ✅ **حماية من تعارض النسخ المتعددة** - قفل العملية (Process Locking)
- ✅ **دعم وضع Webhook** - لمنع أخطاء 409 Conflict

### التحديثات الأخيرة (Latest Updates)

#### إصلاح تسجيل معالجات الأحداث (Event Handler Registration Fix)
تم إصلاح مشكلة حرجة كانت تمنع البوت من:
- ✅ تسجيل المجموعات الجديدة عند الإضافة كمشرف
- ✅ إرسال رسائل الترحيب للمجموعات
- ✅ الرد على أوامر /start و /help وغيرها

للمزيد من التفاصيل، راجع:
- [FIX_SUMMARY.md](FIX_SUMMARY.md) - شرح تقني للإصلاح
- [VISUAL_GUIDE.md](VISUAL_GUIDE.md) - مخططات بصرية توضيحية
- [TESTING.md](TESTING.md) - دليل الاختبار الشامل

### حل مشكلة 409 Conflict

البوت يستخدم **وضع Webhook كإعداد افتراضي** لضمان عدم حدوث تعارضات:

#### وضع Webhook (الافتراضي - موصى به)
- **يمنع تعارضات 409 Conflict نهائياً**
- لا يستخدم getUpdates polling
- مثالي لمنصات الاستضافة مثل Render.com
- أكثر كفاءة وموثوقية من Polling
- راجع [WEBHOOK.md](WEBHOOK.md) للتفاصيل الكاملة.

#### قفل العملية (Process Locking) - حماية إضافية
- يمنع تشغيل نسخ متعددة من البوت في نفس الوقت
- يستخدم ملف PID للتحقق من النسخ الجارية
- تنظيف تلقائي عند إيقاف البوت

**ملاحظة**: للتطوير المحلي، يمكنك استخدام وضع Polling بتغيير `USE_WEBHOOK=false` في ملف `.env`

### التخزين الدائم (Persistent Storage)

تم تكوين البوت لاستخدام التخزين الدائم لضمان حفظ جميع البيانات:

- **في الإنتاج (Render)**: يتم حفظ جميع البيانات في `/data` (قرص دائم)
- **في التطوير المحلي**: يتم حفظ البيانات في `./data`

للمزيد من التفاصيل، راجع [STORAGE.md](STORAGE.md)

### التثبيت والتشغيل

#### للإنتاج (Production - Render.com)

1. انسخ `env.example` إلى `.env` أو استخدم لوحة تحكم Render
2. قم بتعيين المتغيرات المطلوبة في ملف `.env` أو في Render dashboard:
   ```env
   TELEGRAM_BOT_TOKEN=your_bot_token_here
   USE_WEBHOOK=true
   WEBHOOK_URL=https://your-service-name.onrender.com
   ```
3. انشر على Render.com - البوت سيعمل تلقائياً بوضع Webhook.

#### للتطوير المحلي (Local Development)

```bash
# تثبيت المكتبات
npm install

# إعداد ملف البيئة
cp env.example .env

# قم بتحرير .env وإضافة توكن البوت
# للتطوير المحلي، استخدم وضع Polling:
# USE_WEBHOOK=false

# تشغيل البوت
npm start
```

### المتطلبات
- Node.js >= 14.0.0
- توكن بوت من [@BotFather](https://t.me/BotFather)

### الترخيص
MIT